<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>Soa Client</title>
    <style>
        body {font-family: Arial;font-size:12px;background-color:#f2efe8;}
        a {text-decoration:none;color:black;}
        a:hover {text-decoration:underline;}
        .template, .options {display: none;}
        .module, .model, .operation {border: solid 1px gray;padding:5px;margin:5px;cursor:pointer;cursor:hand;}
        .module {background-color: #dbe5f6;}
        .model {background-color: #ffffff;}
        .operation {background-color: #fae8e8;cursor:initial;}
        .operation a {float: right;}
        .form {border: solid 1px gray;margin: 5px;padding: 5px;width: 100%;height:100%;background-color: #ffffff;}
        h1, h2, h3, p {margin: 0px;}
        h1 {font-size:13px;}
        h2 {font-size:12px;}
        h3 {font-size:11px;}
        #service-tree {float:left;width:250px;}
        #right-pane {position:fixed;left: 260px;margin-top: -1px;}
        #form-container {float:left;}
        #tab-container {float: left;margin: 5px;padding-top: 6px;margin-bottom: 0px;}
        .label {width: 150px;display: inline-block;font-weight:bold;}
        .tab {border:solid 1px gray;padding:5px;margin-right:2px;background-color:#f8f6f0;font-size:10px;cursor:hand;cursor:pointer;}
        .tab a {margin-left:5px;}
        .selected {background-color:#ffffff;font-weight:bold;font-size:11px;}
        .request {float:left;width: 400px;border-right: solid 1px gray;height: 100%;}
        .request h1 {height:30px;}
        .request h1 input {float: right;margin-right: 10px;}
        .parameter {}
        .parameter-item {display:inline-block;margin-left:-3px;}
        .parameter-item select {width: 153px;height: 22px;margin: 2px;}
        .parameter-item-added  {margin-left:150px;}
        .response {float: left;overflow: auto;height: 100%;}
        .response .label {width:100px;}
		.response .result {margin-left:5px;clear:both;display:block;font-size: 16px;font-weight: bold;}
        .response .success {color:#18d003;}
		.response .error {color:red;}
		.response .value{font-weight:normal;}
        .response-types{padding: 5px; padding-bottom: 11px;}
        .object-response{display:none;}
        .object-response .empty, .object-response .show-all{margin-left:5px;}
        .object {border: solid 1px gray;margin:5px;padding:5px;}
        .member {margin-left:10px;display:none;}
        .member-item {display:inline-block;}
        .table { width: 99%; border-left: solid 1px; border-top: solid 1px; margin-left: 5px; }
        .table th, .table td{ border-right: solid 1px; border-bottom: solid 1px; padding:3px;}
        .table td.alternate{background-color:#eeecec}
        .table th { text-align: left;}
    </style>
	<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script type="text/javascript">
        /*
        * jQuery Form Plugin; v20140218
        * http://jquery.malsup.com/form/
        * Copyright (c) 2014 M. Alsup; Dual licensed: MIT/GPL
        * https://github.com/malsup/form#copyright-and-license
        */
        ; !function (a) { "use strict"; "function" == typeof define && define.amd ? define(["jquery"], a) : a("undefined" != typeof jQuery ? jQuery : window.Zepto) }(function (a) { "use strict"; function b(b) { var c = b.data; b.isDefaultPrevented() || (b.preventDefault(), a(b.target).ajaxSubmit(c)) } function c(b) { var c = b.target, d = a(c); if (!d.is("[type=submit],[type=image]")) { var e = d.closest("[type=submit]"); if (0 === e.length) return; c = e[0] } var f = this; if (f.clk = c, "image" == c.type) if (void 0 !== b.offsetX) f.clk_x = b.offsetX, f.clk_y = b.offsetY; else if ("function" == typeof a.fn.offset) { var g = d.offset(); f.clk_x = b.pageX - g.left, f.clk_y = b.pageY - g.top } else f.clk_x = b.pageX - c.offsetLeft, f.clk_y = b.pageY - c.offsetTop; setTimeout(function () { f.clk = f.clk_x = f.clk_y = null }, 100) } function d() { if (a.fn.ajaxSubmit.debug) { var b = "[jquery.form] " + Array.prototype.join.call(arguments, ""); window.console && window.console.log ? window.console.log(b) : window.opera && window.opera.postError && window.opera.postError(b) } } var e = {}; e.fileapi = void 0 !== a("<input type='file'/>").get(0).files, e.formdata = void 0 !== window.FormData; var f = !!a.fn.prop; a.fn.attr2 = function () { if (!f) return this.attr.apply(this, arguments); var a = this.prop.apply(this, arguments); return a && a.jquery || "string" == typeof a ? a : this.attr.apply(this, arguments) }, a.fn.ajaxSubmit = function (b) { function c(c) { var d, e, f = a.param(c, b.traditional).split("&"), g = f.length, h = []; for (d = 0; g > d; d++) f[d] = f[d].replace(/\+/g, " "), e = f[d].split("="), h.push([decodeURIComponent(e[0]), decodeURIComponent(e[1])]); return h } function g(d) { for (var e = new FormData, f = 0; f < d.length; f++) e.append(d[f].name, d[f].value); if (b.extraData) { var g = c(b.extraData); for (f = 0; f < g.length; f++) g[f] && e.append(g[f][0], g[f][1]) } b.data = null; var h = a.extend(!0, {}, a.ajaxSettings, b, { contentType: !1, processData: !1, cache: !1, type: i || "POST" }); b.uploadProgress && (h.xhr = function () { var c = a.ajaxSettings.xhr(); return c.upload && c.upload.addEventListener("progress", function (a) { var c = 0, d = a.loaded || a.position, e = a.total; a.lengthComputable && (c = Math.ceil(d / e * 100)), b.uploadProgress(a, d, e, c) }, !1), c }), h.data = null; var j = h.beforeSend; return h.beforeSend = function (a, c) { c.data = b.formData ? b.formData : e, j && j.call(this, a, c) }, a.ajax(h) } function h(c) { function e(a) { var b = null; try { a.contentWindow && (b = a.contentWindow.document) } catch (c) { d("cannot get iframe.contentWindow document: " + c) } if (b) return b; try { b = a.contentDocument ? a.contentDocument : a.document } catch (c) { d("cannot get iframe.contentDocument: " + c), b = a.document } return b } function g() { function b() { try { var a = e(r).readyState; d("state = " + a), a && "uninitialized" == a.toLowerCase() && setTimeout(b, 50) } catch (c) { d("Server abort: ", c, " (", c.name, ")"), h(A), w && clearTimeout(w), w = void 0 } } var c = l.attr2("target"), f = l.attr2("action"), g = "multipart/form-data", j = l.attr("enctype") || l.attr("encoding") || g; x.setAttribute("target", o), (!i || /post/i.test(i)) && x.setAttribute("method", "POST"), f != m.url && x.setAttribute("action", m.url), m.skipEncodingOverride || i && !/post/i.test(i) || l.attr({ encoding: "multipart/form-data", enctype: "multipart/form-data" }), m.timeout && (w = setTimeout(function () { v = !0, h(z) }, m.timeout)); var k = []; try { if (m.extraData) for (var n in m.extraData) m.extraData.hasOwnProperty(n) && (a.isPlainObject(m.extraData[n]) && m.extraData[n].hasOwnProperty("name") && m.extraData[n].hasOwnProperty("value") ? k.push(a('<input type="hidden" name="' + m.extraData[n].name + '">').val(m.extraData[n].value).appendTo(x)[0]) : k.push(a('<input type="hidden" name="' + n + '">').val(m.extraData[n]).appendTo(x)[0])); m.iframeTarget || q.appendTo("body"), r.attachEvent ? r.attachEvent("onload", h) : r.addEventListener("load", h, !1), setTimeout(b, 15); try { x.submit() } catch (p) { var s = document.createElement("form").submit; s.apply(x) } } finally { x.setAttribute("action", f), x.setAttribute("enctype", j), c ? x.setAttribute("target", c) : l.removeAttr("target"), a(k).remove() } } function h(b) { if (!s.aborted && !F) { if (E = e(r), E || (d("cannot access response document"), b = A), b === z && s) return s.abort("timeout"), y.reject(s, "timeout"), void 0; if (b == A && s) return s.abort("server abort"), y.reject(s, "error", "server abort"), void 0; if (E && E.location.href != m.iframeSrc || v) { r.detachEvent ? r.detachEvent("onload", h) : r.removeEventListener("load", h, !1); var c, f = "success"; try { if (v) throw "timeout"; var g = "xml" == m.dataType || E.XMLDocument || a.isXMLDoc(E); if (d("isXml=" + g), !g && window.opera && (null === E.body || !E.body.innerHTML) && --G) return d("requeing onLoad callback, DOM not available"), setTimeout(h, 250), void 0; var i = E.body ? E.body : E.documentElement; s.responseText = i ? i.innerHTML : null, s.responseXML = E.XMLDocument ? E.XMLDocument : E, g && (m.dataType = "xml"), s.getResponseHeader = function (a) { var b = { "content-type": m.dataType }; return b[a.toLowerCase()] }, i && (s.status = Number(i.getAttribute("status")) || s.status, s.statusText = i.getAttribute("statusText") || s.statusText); var j = (m.dataType || "").toLowerCase(), k = /(json|script|text)/.test(j); if (k || m.textarea) { var l = E.getElementsByTagName("textarea")[0]; if (l) s.responseText = l.value, s.status = Number(l.getAttribute("status")) || s.status, s.statusText = l.getAttribute("statusText") || s.statusText; else if (k) { var o = E.getElementsByTagName("pre")[0], p = E.getElementsByTagName("body")[0]; o ? s.responseText = o.textContent ? o.textContent : o.innerText : p && (s.responseText = p.textContent ? p.textContent : p.innerText) } } else "xml" == j && !s.responseXML && s.responseText && (s.responseXML = H(s.responseText)); try { D = J(s, j, m) } catch (t) { f = "parsererror", s.error = c = t || f } } catch (t) { d("error caught: ", t), f = "error", s.error = c = t || f } s.aborted && (d("upload aborted"), f = null), s.status && (f = s.status >= 200 && s.status < 300 || 304 === s.status ? "success" : "error"), "success" === f ? (m.success && m.success.call(m.context, D, "success", s), y.resolve(s.responseText, "success", s), n && a.event.trigger("ajaxSuccess", [s, m])) : f && (void 0 === c && (c = s.statusText), m.error && m.error.call(m.context, s, f, c), y.reject(s, "error", c), n && a.event.trigger("ajaxError", [s, m, c])), n && a.event.trigger("ajaxComplete", [s, m]), n && !--a.active && a.event.trigger("ajaxStop"), m.complete && m.complete.call(m.context, s, f), F = !0, m.timeout && clearTimeout(w), setTimeout(function () { m.iframeTarget ? q.attr("src", m.iframeSrc) : q.remove(), s.responseXML = null }, 100) } } } var j, k, m, n, o, q, r, s, t, u, v, w, x = l[0], y = a.Deferred(); if (y.abort = function (a) { s.abort(a) }, c) for (k = 0; k < p.length; k++) j = a(p[k]), f ? j.prop("disabled", !1) : j.removeAttr("disabled"); if (m = a.extend(!0, {}, a.ajaxSettings, b), m.context = m.context || m, o = "jqFormIO" + (new Date).getTime(), m.iframeTarget ? (q = a(m.iframeTarget), u = q.attr2("name"), u ? o = u : q.attr2("name", o)) : (q = a('<iframe name="' + o + '" src="' + m.iframeSrc + '" />'), q.css({ position: "absolute", top: "-1000px", left: "-1000px" })), r = q[0], s = { aborted: 0, responseText: null, responseXML: null, status: 0, statusText: "n/a", getAllResponseHeaders: function () { }, getResponseHeader: function () { }, setRequestHeader: function () { }, abort: function (b) { var c = "timeout" === b ? "timeout" : "aborted"; d("aborting upload... " + c), this.aborted = 1; try { r.contentWindow.document.execCommand && r.contentWindow.document.execCommand("Stop") } catch (e) { } q.attr("src", m.iframeSrc), s.error = c, m.error && m.error.call(m.context, s, c, b), n && a.event.trigger("ajaxError", [s, m, c]), m.complete && m.complete.call(m.context, s, c) } }, n = m.global, n && 0 === a.active++ && a.event.trigger("ajaxStart"), n && a.event.trigger("ajaxSend", [s, m]), m.beforeSend && m.beforeSend.call(m.context, s, m) === !1) return m.global && a.active--, y.reject(), y; if (s.aborted) return y.reject(), y; t = x.clk, t && (u = t.name, u && !t.disabled && (m.extraData = m.extraData || {}, m.extraData[u] = t.value, "image" == t.type && (m.extraData[u + ".x"] = x.clk_x, m.extraData[u + ".y"] = x.clk_y))); var z = 1, A = 2, B = a("meta[name=csrf-token]").attr("content"), C = a("meta[name=csrf-param]").attr("content"); C && B && (m.extraData = m.extraData || {}, m.extraData[C] = B), m.forceSync ? g() : setTimeout(g, 10); var D, E, F, G = 50, H = a.parseXML || function (a, b) { return window.ActiveXObject ? (b = new ActiveXObject("Microsoft.XMLDOM"), b.async = "false", b.loadXML(a)) : b = (new DOMParser).parseFromString(a, "text/xml"), b && b.documentElement && "parsererror" != b.documentElement.nodeName ? b : null }, I = a.parseJSON || function (a) { return window.eval("(" + a + ")") }, J = function (b, c, d) { var e = b.getResponseHeader("content-type") || "", f = "xml" === c || !c && e.indexOf("xml") >= 0, g = f ? b.responseXML : b.responseText; return f && "parsererror" === g.documentElement.nodeName && a.error && a.error("parsererror"), d && d.dataFilter && (g = d.dataFilter(g, c)), "string" == typeof g && ("json" === c || !c && e.indexOf("json") >= 0 ? g = I(g) : ("script" === c || !c && e.indexOf("javascript") >= 0) && a.globalEval(g)), g }; return y } if (!this.length) return d("ajaxSubmit: skipping submit process - no element selected"), this; var i, j, k, l = this; "function" == typeof b ? b = { success: b } : void 0 === b && (b = {}), i = b.type || this.attr2("method"), j = b.url || this.attr2("action"), k = "string" == typeof j ? a.trim(j) : "", k = k || window.location.href || "", k && (k = (k.match(/^([^#]+)/) || [])[1]), b = a.extend(!0, { url: k, success: a.ajaxSettings.success, type: i || a.ajaxSettings.type, iframeSrc: /^https/i.test(window.location.href || "") ? "javascript:false" : "about:blank" }, b); var m = {}; if (this.trigger("form-pre-serialize", [this, b, m]), m.veto) return d("ajaxSubmit: submit vetoed via form-pre-serialize trigger"), this; if (b.beforeSerialize && b.beforeSerialize(this, b) === !1) return d("ajaxSubmit: submit aborted via beforeSerialize callback"), this; var n = b.traditional; void 0 === n && (n = a.ajaxSettings.traditional); var o, p = [], q = this.formToArray(b.semantic, p); if (b.data && (b.extraData = b.data, o = a.param(b.data, n)), b.beforeSubmit && b.beforeSubmit(q, this, b) === !1) return d("ajaxSubmit: submit aborted via beforeSubmit callback"), this; if (this.trigger("form-submit-validate", [q, this, b, m]), m.veto) return d("ajaxSubmit: submit vetoed via form-submit-validate trigger"), this; var r = a.param(q, n); o && (r = r ? r + "&" + o : o), "GET" == b.type.toUpperCase() ? (b.url += (b.url.indexOf("?") >= 0 ? "&" : "?") + r, b.data = null) : b.data = r; var s = []; if (b.resetForm && s.push(function () { l.resetForm() }), b.clearForm && s.push(function () { l.clearForm(b.includeHidden) }), !b.dataType && b.target) { var t = b.success || function () { }; s.push(function (c) { var d = b.replaceTarget ? "replaceWith" : "html"; a(b.target)[d](c).each(t, arguments) }) } else b.success && s.push(b.success); if (b.success = function (a, c, d) { for (var e = b.context || this, f = 0, g = s.length; g > f; f++) s[f].apply(e, [a, c, d || l, l]) }, b.error) { var u = b.error; b.error = function (a, c, d) { var e = b.context || this; u.apply(e, [a, c, d, l]) } } if (b.complete) { var v = b.complete; b.complete = function (a, c) { var d = b.context || this; v.apply(d, [a, c, l]) } } var w = a("input[type=file]:enabled", this).filter(function () { return "" !== a(this).val() }), x = w.length > 0, y = "multipart/form-data", z = l.attr("enctype") == y || l.attr("encoding") == y, A = e.fileapi && e.formdata; d("fileAPI :" + A); var B, C = (x || z) && !A; b.iframe !== !1 && (b.iframe || C) ? b.closeKeepAlive ? a.get(b.closeKeepAlive, function () { B = h(q) }) : B = h(q) : B = (x || z) && A ? g(q) : a.ajax(b), l.removeData("jqxhr").data("jqxhr", B); for (var D = 0; D < p.length; D++) p[D] = null; return this.trigger("form-submit-notify", [this, b]), this }, a.fn.ajaxForm = function (e) { if (e = e || {}, e.delegation = e.delegation && a.isFunction(a.fn.on), !e.delegation && 0 === this.length) { var f = { s: this.selector, c: this.context }; return !a.isReady && f.s ? (d("DOM not ready, queuing ajaxForm"), a(function () { a(f.s, f.c).ajaxForm(e) }), this) : (d("terminating; zero elements found by selector" + (a.isReady ? "" : " (DOM not ready)")), this) } return e.delegation ? (a(document).off("submit.form-plugin", this.selector, b).off("click.form-plugin", this.selector, c).on("submit.form-plugin", this.selector, e, b).on("click.form-plugin", this.selector, e, c), this) : this.ajaxFormUnbind().bind("submit.form-plugin", e, b).bind("click.form-plugin", e, c) }, a.fn.ajaxFormUnbind = function () { return this.unbind("submit.form-plugin click.form-plugin") }, a.fn.formToArray = function (b, c) { var d = []; if (0 === this.length) return d; var f, g = this[0], h = this.attr("id"), i = b ? g.getElementsByTagName("*") : g.elements; if (i && !/MSIE 8/.test(navigator.userAgent) && (i = a(i).get()), h && (f = a(":input[form=" + h + "]").get(), f.length && (i = (i || []).concat(f))), !i || !i.length) return d; var j, k, l, m, n, o, p; for (j = 0, o = i.length; o > j; j++) if (n = i[j], l = n.name, l && !n.disabled) if (b && g.clk && "image" == n.type) g.clk == n && (d.push({ name: l, value: a(n).val(), type: n.type }), d.push({ name: l + ".x", value: g.clk_x }, { name: l + ".y", value: g.clk_y })); else if (m = a.fieldValue(n, !0), m && m.constructor == Array) for (c && c.push(n), k = 0, p = m.length; p > k; k++) d.push({ name: l, value: m[k] }); else if (e.fileapi && "file" == n.type) { c && c.push(n); var q = n.files; if (q.length) for (k = 0; k < q.length; k++) d.push({ name: l, value: q[k], type: n.type }); else d.push({ name: l, value: "", type: n.type }) } else null !== m && "undefined" != typeof m && (c && c.push(n), d.push({ name: l, value: m, type: n.type, required: n.required })); if (!b && g.clk) { var r = a(g.clk), s = r[0]; l = s.name, l && !s.disabled && "image" == s.type && (d.push({ name: l, value: r.val() }), d.push({ name: l + ".x", value: g.clk_x }, { name: l + ".y", value: g.clk_y })) } return d }, a.fn.formSerialize = function (b) { return a.param(this.formToArray(b)) }, a.fn.fieldSerialize = function (b) { var c = []; return this.each(function () { var d = this.name; if (d) { var e = a.fieldValue(this, b); if (e && e.constructor == Array) for (var f = 0, g = e.length; g > f; f++) c.push({ name: d, value: e[f] }); else null !== e && "undefined" != typeof e && c.push({ name: this.name, value: e }) } }), a.param(c) }, a.fn.fieldValue = function (b) { for (var c = [], d = 0, e = this.length; e > d; d++) { var f = this[d], g = a.fieldValue(f, b); null === g || "undefined" == typeof g || g.constructor == Array && !g.length || (g.constructor == Array ? a.merge(c, g) : c.push(g)) } return c }, a.fieldValue = function (b, c) { var d = b.name, e = b.type, f = b.tagName.toLowerCase(); if (void 0 === c && (c = !0), c && (!d || b.disabled || "reset" == e || "button" == e || ("checkbox" == e || "radio" == e) && !b.checked || ("submit" == e || "image" == e) && b.form && b.form.clk != b || "select" == f && -1 == b.selectedIndex)) return null; if ("select" == f) { var g = b.selectedIndex; if (0 > g) return null; for (var h = [], i = b.options, j = "select-one" == e, k = j ? g + 1 : i.length, l = j ? g : 0; k > l; l++) { var m = i[l]; if (m.selected) { var n = m.value; if (n || (n = m.attributes && m.attributes.value && !m.attributes.value.specified ? m.text : m.value), j) return n; h.push(n) } } return h } return a(b).val() }, a.fn.clearForm = function (b) { return this.each(function () { a("input,select,textarea", this).clearFields(b) }) }, a.fn.clearFields = a.fn.clearInputs = function (b) { var c = /^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i; return this.each(function () { var d = this.type, e = this.tagName.toLowerCase(); c.test(d) || "textarea" == e ? this.value = "" : "checkbox" == d || "radio" == d ? this.checked = !1 : "select" == e ? this.selectedIndex = -1 : "file" == d ? /MSIE/.test(navigator.userAgent) ? a(this).replaceWith(a(this).clone(!0)) : a(this).val("") : b && (b === !0 && /hidden/.test(d) || "string" == typeof b && a(this).is(b)) && (this.value = "") }) }, a.fn.resetForm = function () { return this.each(function () { ("function" == typeof this.reset || "object" == typeof this.reset && !this.reset.nodeType) && this.reset() }) }, a.fn.enable = function (a) { return void 0 === a && (a = !0), this.each(function () { this.disabled = !a }) }, a.fn.selected = function (b) { return void 0 === b && (b = !0), this.each(function () { var c = this.type; if ("checkbox" == c || "radio" == c) this.checked = b; else if ("option" == this.tagName.toLowerCase()) { var d = a(this).parent("select"); b && d[0] && "select-one" == d[0].type && d.find("option").selected(!1), this.selected = b } }) }, a.fn.ajaxSubmit.debug = !1 });
    </script>
    <script type="text/javascript">
        var urlBase = "@urlBase";
        var models, tmp_module, tmp_model, tmp_operation, tmp_tab, tmp_form, tmp_parameter, tmp_parameter_item, 
            tmp_response_types, tmp_object_response, tmp_object, tmp_member, tmp_member_item, tmp_table_response;

        $(function () {

            $("#tab-container").width($(window).width() - 300);
            $("#form-container").width($(window).width() - 300).height($(window).height() - 70);
            $(".response").width($("#form-container").width() - 420);
            $(window).resize(function () {
                $("#tab-container").width($(window).width() - 300);
                $("#form-container").width($(window).width() - 300).height($(window).height() - 70);
                $(".response").width($("#form-container").width() - 420);
            });

            tmp_module = $("#module").clone().wrap("<p>").parent().html();
            tmp_model = $("#model").clone().wrap("<p>").parent().html();
            tmp_operation = $("#operation").clone().wrap("<p>").parent().html();
            tmp_tab = $("#tab").clone().wrap("<p>").parent().html();
            tmp_form = $("#form").clone().wrap("<p>").parent().html();
            tmp_parameter = $("#parameter").clone().wrap("<p>").parent().html();
            tmp_parameter_item = $("#parameter-item").clone().wrap("<p>").parent().html();
            tmp_response_types = $("#response-types").clone().wrap("<p>").parent().html();
            tmp_object_response = $("#object-response").clone().wrap("<p>").parent().html();
            tmp_object = $("#object").clone().wrap("<p>").parent().html();
            tmp_member = $("#member").clone().wrap("<p>").parent().html();
            tmp_member_item = $("#member-item").clone().wrap("<p>").parent().html();
            tmp_table_response = $("#table-response").clone().wrap("<p>").parent().html();

            $.get(urlBase + "/GetApplicationModel", function (data) {
                models = data.Models;
                for (var i = 0; i < models.length; i++) {
                    var model = models[i];

                    if (model.Operations.length <= 0) {
                        continue;
                    }
                    var moduleDiv = getModuleDiv(model.Module);

                    var modelDiv =
                        $(tmp_model.replace(/@id/g, model.Id).replace(/@name/g, model.Name))
                        .removeAttr("id").removeClass("template").addClass("model")
                        .appendTo(moduleDiv)
                        .children(":first-child").click(function () {
                            $(this).siblings("div").each(function () { $(this).toggle() });
                        })
                        .parent();

                    for (var j = 0; j < model.Operations.length; j++) {
                        var operation = model.Operations[j];

                        $(tmp_operation
                            .replace(/@id/g, operation.Id)
                            .replace(/@modelId/g, model.Id))
                            .removeAttr("id").removeClass("template").addClass("operation")
                            .appendTo(modelDiv);
                    }

                   modelDiv.children(":first-child").click();
                }

                $(".module").each(function () {
                    $(this).children(":first-child").click();
                });

            }, "json");

            function getModuleDiv(moduleName) {
                var result = $("div[data-module=" + moduleName + "]");
                if (result.length == 0) {
                    return $(tmp_module.replace(/@name/g, moduleName))
                        .removeAttr("id").removeClass("template").addClass("module")
                        .appendTo($("#service-tree"))
                        .children(":first-child").click(function () {
                            $(this).siblings("div").each(function () { $(this).toggle() });
                        })
                        .parent();
                }

                return result;
            }
        });

        function createForm(modelId, operationId) {
            var model = getModel(modelId);
            var operation = getOperation(model, operationId);

            var operationTab = $(tmp_tab
                .replace(/@id/g, operation.Id)
                .replace(/@modelName/g, model.Name))
                .removeAttr("id").removeClass("template").addClass("tab")
                .appendTo($("#tab-container"))
                .click(function () {
                    $("#form-container").children("form").hide();
                    $("#tab-container").children(".tab").removeClass("selected");

                    $($("#form-container").children("form").get($(this).index())).show();
                    $(this).addClass("selected");
                });

            var operationForm = $(tmp_form
                .replace(/@id/g, operation.Id)
                .replace(/@modelId/g, model.Id)
                .replace(/@modelName/g, model.Name)
                .replace(/@targetOptions/g, getOptions(model.Id)))
                .removeAttr("id").removeClass("template").addClass("form")
                .appendTo($("#form-container"));

            for (var i = 0; i < operation.Parameters.length; i++) {
                var parameter = operation.Parameters[i];
                
                var parameterDiv = $(tmp_parameter
                    .replace(/@id/g, parameter.Id)
                    .replace(/@index/g, i)
                    .replace(/@modelId/g, parameter.ViewModelId)
                    .replace(/@isList/g, parameter.IsList)
                    .replace(/@options/g, getOptions(parameter.ViewModelId)))
                    .removeAttr("id").removeClass("template").addClass("parameter")
                    .appendTo(operationForm.children(".request:first-child"));

                parameterDiv.children("input.add").click();
            }

            operationForm.ajaxForm({
                dataType: 'json',
                beforeSubmit: function(arr, $form, options) {
                	$form.children(".response").empty();
                },
                success: showResponse,
                error: function(req, status, error, $form){ 
                    if(req.status == 200) {
                        showResponse({}, "success", req, $form);
                    }
                }
            });

            renderOptions();
            operationTab.click();
        }

        function getOptions(modelId) {
            var options;
            $.ajax({ url: urlBase + '/GetAvailableObjects', 
                async: false,
                dataType: 'json',
                data:{objectModelId:modelId},
                success: function(data) {
                    options = data;
                }
            });

            var result = "";
            for(var j = 0; j<options.length; j++) {
                var option = normalizeObject(options[j]);

                result += option.Reference.Id + "|";
            }
            if(result.length > 0) {
                result = result.substr(0, result.length - 1);
            }

            return result;
        }

        function renderOptions() {
            $("input[type=text]").each(function() {
                if(!hasAttr($(this), "data-options")) {
                    return;
                }

                var options = $(this).attr("data-options");
                if(options == null || options == "") {
                    return;
                }

                var item = "<select name='"+$(this).attr("name") + "'>";
                var optionArray = options.split("|");
                for(var i = 0; i<optionArray.length; i++) {
                    item += "<option value='" + optionArray[i] + "'>" + optionArray[i] + "</option>";
                }
                item +="</select>";
                $(this).before(item);
                $(this).remove();
            });
        }

        function hasAttr(element, key) {
            return !(typeof element.attr(key) === 'undefined');
        }

        function addParameter(addButton, paramIndex, modelId, isList) {
            addButton = $(addButton);
            var index = -1;
            if(hasAttr(addButton.prev(), "data-index")) {
                index = parseInt(addButton.prev().attr("data-index"));
            }

            index++;
            var options = addButton.next().next().html();
            var parameterItemDiv = $(tmp_parameter_item
                    .replace(/@paramIndex/g, paramIndex)
                    .replace(/@modelId/g, modelId)
                    .replace(/@index/g, index)
                    .replace(/@options/g, options))
                    .removeAttr("id").removeClass("template").addClass("parameter-item");

            if(index > 0) {
                parameterItemDiv.addClass("parameter-item-added");
            }

            addButton.before(parameterItemDiv);

            if(!isList) {
                addButton.next().remove();
                addButton.remove();
            }

            renderOptions();
        }

        function removeParameter(removeButton) {
            removeButton = $(removeButton);
            
            var index = -1;
            if(hasAttr(removeButton.prev().prev(), "data-index")){
                index = parseInt(removeButton.prev().prev().attr("data-index"));
            }

            if(index >= 0) {
                removeButton.prev().prev().remove();
            }
        }

        function closeForm(tab) {
            tab = $(tab).parent();
            var selected = tab.hasClass("selected");

            var form = $($("#form-container").children("form").get(tab.index()));

            form.remove();
            tab.remove();

            if (selected) {
                $("#tab-container").children(":first-child").click();
            }
        }

        function getModel(modelId) {
            for (var i = 0; i < models.length; i++) {
                if (models[i].Id == modelId) {
                    return models[i];
                }
            }

            return {Id:modelId,Marks:[],Name:modelId,Module:"",IsValueModel:true,IsViewModel:false,Members:[],Operations:[]};
        }

        function getOperation(model, operationId) {
            for (var i = 0; i < model.Operations.length; i++) {
                if (model.Operations[i].Id == operationId) {
                    return model.Operations[i];
                }
            }
        }

        function showResponse(data, statusText, xhr, $form) {
            var responseDiv = $form.children(".response");
            responseDiv.empty();
            
            if(data.IsException) {
                showError(responseDiv, data);
                return;
            }

            responseDiv.append("<span class='result success'>" + statusText + "</span>");

            var model = getModel($form.attr("data-model-id"));
            var operation = getOperation(model, $form.attr("data-operation-id"));
            var resultModel = getModel(operation.Result.ViewModelId);

            if (operation.Result.IsVoid) {
                return;
            }
            
            var data = normalizeValue(data);
            
            var responseTypesDiv = $(tmp_response_types)
                .removeAttr("id").removeClass("template").addClass("response-types")
                .appendTo(responseDiv);

            showTableResponse(responseDiv, data, resultModel);
            showObjectResponse(responseDiv, data, resultModel);

            if(!data.IsList) {
                responseTypesDiv.children("input.object-type").click();
            }
        }

        function showError(domObj, data) {
            domObj.append(
                "<span class='result error'>" + 
                    "exception: <span class='value'>" + data.Message + "</span><br/>" +
                    "type: <span class='value'>" + data.Type + "</span><br/>" +
                    "handled: <span class='value'>" + data.IsHandled + "</span>" +
                "</span>");
        }

        function showTableResponse(responseDiv, data, model) {
            var tableResponseDiv = $(tmp_table_response)
                .removeAttr("id").removeClass("template").addClass("table-response")
                .appendTo(responseDiv);

            var table = tableResponseDiv.children("table:first-child");

            if(data.Values.length <= 0) {
                table.append("<tr><th>Empty</th></tr>");
                return;
            }

            var row = $("<tr>");
            row.append("<th>Id</th>");
            for (var memberModelId in data.Values[0].Members) {
                row.append("<th>" + memberModelId + "</th>");
            }
            row.appendTo(table);

            for(var i = 0; i<data.Values.length; i++) {
                var obj = data.Values[i];
                row = $("<tr>");
                
                var cell = $("<td>"+obj.Reference.Id+"</td>");
                if(i%2==0){cell.addClass("alternate");}
                cell.appendTo(row);
                
                for (var memberModelId in obj.Members) {
                    cell = $("<td>");
                    showMember(cell, obj.Members[memberModelId]);
                    if(i%2==0){cell.addClass("alternate");}
                    cell.appendTo(row);
                }
                row.appendTo(table);
            }
        }

        function showObjectResponse(responseDiv, data, model) {
            var objectResponseDiv = $(tmp_object_response)
                .removeAttr("id").removeClass("template").addClass("object-response")
                .appendTo(responseDiv);

            if(data.Values.length<=0) {
                objectResponseDiv.append("<b class='empty'>Empty</b>");
                return;
            }

            if(data.Values.length > 1) {
                objectResponseDiv.append("<input type='button' class='show-all' value='Show All' onclick='javascript:showAll(this)' />");
            }

            for (var i = 0; i < data.Values.length; i++) {
                var obj = data.Values[i];
                var objectDiv = $(tmp_object
                    .replace(/@id/g, obj.Reference.Id)
                    .replace(/@actualModelId/g, obj.Reference.ActualModelId)
                    .replace(/@viewModelId/g, obj.Reference.ViewModelId)
                    .replace(/@value/g, obj.Value))
                    .removeAttr("id").removeClass("template").addClass("object")
                    .appendTo(objectResponseDiv);
                if(model.IsValueModel) {
                    objectDiv.children("p.details").remove();
                } else {
                    for(var memberModelId in obj.Members) {
                        var member = obj.Members[memberModelId];
                        var memberDiv = $(tmp_member
                            .replace(/@name/g, memberModelId))
                            .removeAttr("id").removeClass("template").addClass("member")
                            .appendTo(objectDiv);

                        showMember(memberDiv, member);
                    }
                }
            }
        }

        function showMember(memberDiv, data) {
            for(var j = 0; j<data.Values.length; j++) {
                var value = data.Values[j];

                var memberItemDiv = $(tmp_member_item
                    .replace(/@id/g, value.Reference.Id)
                    .replace(/@value/g, value.Value))
                    .removeAttr("id").removeClass("template").addClass("member-item")
                    .appendTo(memberDiv);
                        
                if(value.Reference.IsNull) {
                    memberItemDiv.html("[null]");
                } else if(getModel(value.Reference.ActualModelId).IsValueModel) {
                    memberItemDiv.html(value.Reference.Id);
                }
            }
        }

        function showResponseType(radio) {
            radio = $(radio);
            if(radio.val() == "object") {
                radio.parent().parent().children(".object-response").show();
                radio.parent().parent().children(".table-response").hide();
            } else if(radio.val() == "table") {
                radio.parent().parent().children(".table-response").show();
                radio.parent().parent().children(".object-response").hide();
            }
        }

        function normalizeValue(data) {
            var result = new Object();
            result.Values = new Array();
            if(data instanceof Array) {
                result.IsList = true;
                for(var i = 0; i<data.length; i++) {
                    result.Values[i] = data[i];
                }
            } else {
                result.IsList = false;
                result.Values[0] = data;
            }
            
            for (var i = 0; i < result.Values.length; i++) {
                result.Values[i] = normalizeObject(result.Values[i]);
            }
            return result;
        }

        function normalizeObject(data) {
            if(data == null) {
                data = new Object();
                data.Reference = new Object();
                data.Reference.IsNull = true;
                return data;
            }

            if(data.Ref == undefined) {
                var temp = new Object();
                temp.Ref = data;
                data = temp;
            }

            data.Reference = normalizeReference(data.Ref);
            if(data.Value == undefined) {
                data.Value = data.Reference.Id;
            }
            if(data.Members == undefined) {
                data.Members = new Array();
            }

            for(var memberModelId in data.Members) {
                data.Members[memberModelId] = normalizeValue(data.Members[memberModelId]);
            }

            return data;
        }

        function normalizeReference(referenceString)
        {
            var result = new Object();
            result.Id = referenceString.substring(0, referenceString.indexOf("#"));
            referenceString = referenceString.substring(referenceString.indexOf("#") + 1, referenceString.length);
            if(referenceString.indexOf("#") >= 0)
            {
                result.ActualModelId = referenceString.substring(0, referenceString.indexOf("#"));
                result.ViewModelId = referenceString.substring(referenceString.indexOf("#"), referenceString.length);
            }
            else
            {
                result.ActualModelId = referenceString;
                result.ViewModelId = referenceString;
            }

            return result;
        }

        function showDetails(showButton) {
            showButton = $(showButton);
            if(showButton.val() == "Show") {
                showButton.parent().parent().children(".member").show();
                showButton.val("Hide");
            } else {
                showButton.parent().parent().children(".member").hide();
                showButton.val("Show");
            }
        }

        function showAll(showButton) {
            showButton = $(showButton);
            if(showButton.val() == "Show All") {
                showButton.parent().children(".object").children(".member").show();
                showButton.parent().children(".object").children("p").children("input[type=button]").val("Hide");
                showButton.val("Hide All");
            } else {
                showButton.parent().children(".object").children(".member").hide();
                showButton.parent().children(".object").children("p").children("input[type=button]").val("Show");
                showButton.val("Show All");
            }
        }
    </script>
</head>
<body>
    <div id="service-tree"></div>
    <div id="right-pane">
        <div id="tab-container"></div>
        <div id="form-container"></div>
    </div>
    <div id="module" class="template" data-module="@name"><h1>@name</h1></div>
    <div id="model" class="template"><h2>@name</h2></div>
    <div id="operation" class="template"><h3>@id<a href="javascript:createForm('@modelId','@id');">Open</a></h3></div>
    <span id="tab" class="template">@modelName - @id<a href="javascript:void(0)" onclick="javascript:closeForm(this)">&#10005;</a></span>
    <form id="form" class="template" action="/Soa/PerformOperation" method="post" data-model-id="@modelId" data-operation-id="@id">
        <div class="request">
            <h1>
                @modelName - @id
                <input type="submit" value="Call &#9658;"/>
            </h1>
            <div class="parameter">
                <span class="label">@modelNameId:</span>
                <div class="parameter-item">
                    <input type="hidden" name="targetReference.ActualModelId" value="@modelId"/>
                    <input type="hidden" name="targetReference.ViewModelId" value="@modelId"/>
                    <input type="text" name="targetReference.Id" data-options="@targetOptions"/>
                </div>
            </div>
            <input type="hidden" name="operationModelId" value="@id" />
        </div>
        <div class="response"></div>
    </form>
    <div id="parameter" class="template">
        <span class="label">@id:</span>
        <input type="hidden" name="parameterValues[@index].Key" value="@id" />
        <input class="add" type="button" value="+" onclick="javascript:addParameter(this, @index, '@modelId', @isList)" />
        <input class="remove" type="button" value="-" onclick="javascript:removeParameter(this)" />
        <span class="options">@options</span>
    </div>
    <div id="parameter-item" class="template" data-index="@index">
        <input type="hidden" name="parameterValues[@paramIndex].Value.References[@index].ActualModelId" value="@modelId"/>
        <input type="hidden" name="parameterValues[@paramIndex].Value.References[@index].ViewModelId" value="@modelId"/>
        <input type="text" name="parameterValues[@paramIndex].Value.References[@index].Id" data-options="@options"/>
    </div>
    <div id="response-types" class="template">
        <input type="radio" class="table-type" name="response-type" value="table" checked="checked" onclick="javascript:showResponseType(this)"/><label for="table">Table</label>
        <input type="radio" class="object-type" name="response-type" value="object" onclick="javascript:showResponseType(this)"/><label for="object">Object</label>
    </div>
    <div id="object-response" class="template"></div>
    <div id="object" class="template">
        <p><span class="label">id:</span>@id</p>
        <p class="details"><span class="label">value:</span>@value</p>
        <p class="details"><span class="label">details:</span><input type="button" value="Show" onclick="javascript:showDetails(this)" /></p>
    </div>
    <p id="member" class="template"><span class="label">@name:</span></p>
    <div id="member-item" class="template">
        [@id, @value]
    </div>
    <div id="table-response" class="template"><table class="table" cellspacing="0" cellpadding="0"></table></div>
</body>
</html>